# Unity多视点映像混合实验环境说明

## 项目概述
这是一个Unity实验环境，用于研究**遠隔操縦における多視点映像混合手法の主観的速度再現性**。该系统实现了多视点映像即时混合技术，用于测试等价的无延迟化效果。

## 核心功能模块

### 1. 多视点摄像头系统
- **captureCamera1**: 前视点摄像头，用于捕获当前位置的图像
- **captureCamera2**: 后视点摄像头，位置偏移一个捕获间隔距离
- **RenderTexture**: 两个摄像头的渲染纹理存储

### 2. 实验模式
系统提供三种实验模式：

#### A. Continuous（连续模式）
- 单一摄像头连续移动
- 用于基准测试
- 数据记录：帧数、时间、Vection反应

#### B. Wobble（摆动模式）
- 摄像头摆动运动
- 用于控制实验
- 数据记录：帧数、时间、Vection反应

#### C. LuminanceMixture（亮度混合模式）
- **核心功能**：实现两视点的亮度混合
- 使用线性插值算法混合两个视点
- 数据记录：前帧编号、前帧亮度、后帧编号、后帧亮度、时间、Vection反应

### 3. 亮度混合算法实现

```csharp
// 计算时间比例
float preImageToNowDeltaTime = timeMs - bufferDurTime - (frameNum - 1) * updateInterval * 1000;
float nextRatio = preImageToNowDeltaTime / (updateInterval * 1000);
float nextImageRatio = nextRatio > 1.0f ? 1.0f : nextRatio;
nextImageRatio = nextImageRatio < 0 ? 0 : nextImageRatio;
float previousImageRatio = 1.0f - nextRatio;

// 应用亮度混合
preImageRawImage.color = new Color(r, g, b, previousImageRatio);
nextImageRawImage.color = new Color(r, g, b, nextImageRatio);
```

**混合策略**：
- 使用时间线性插值：`nextRatio = deltaTime / updateInterval`
- 前帧权重：`previousImageRatio = 1 - nextRatio`
- 后帧权重：`nextImageRatio = nextRatio`

### 4. 实验参数控制

#### 可调参数
- **cameraSpeed**: 摄像头移动速度 (m/s)
- **captureIntervalDistance**: 捕获间隔距离 (m)
- **updateInterval**: 更新间隔 (秒)
- **fps**: 帧率设置
- **trialTime**: 实验总时间 (毫秒)
- **bufferDurTime**: 缓冲时间

#### 实验条件记录
- 参与者姓名：`participantName`
- 试验编号：`trialNumber`
- 实验条件：`experimentalCondition`
- 移动方向：`DirectionPattern` (forward/right)

### 5. 数据收集系统

#### 实时数据记录
- **Vection反应**: 通过按键1检测参与者的运动视觉感知
- **时间戳**: 精确到毫秒的时间记录
- **帧同步**: 与视觉刺激同步的数据采集

#### 输出数据格式
**亮度混合模式**：
```csv
FrondFrameNum,FrondFrameLuminance,BackFrameNum,BackFrameLuminance,Time,Vection Response
```

**其他模式**：
```csv
FrameNum,Time,Vection Response
```

### 6. 用户界面设计
- **Gray Screen**: 实验间隔的灰色屏幕
- **Canvas**: 图像显示画布
- **RawImage**: 两个视点的图像显示组件

## 实验流程

### 1. 初始化阶段
- 设置实验参数
- 初始化摄像头位置
- 准备数据记录系统

### 2. 缓冲阶段
- 显示灰色屏幕
- 记录基准数据
- 时长：`bufferDurTime`

### 3. 实验阶段
- 根据选择的模式执行相应的视觉刺激
- 实时记录参与者反应
- 时长：`trialTime`

### 4. 结束阶段
- 再次显示灰色屏幕
- 保存实验数据
- 自动退出或准备下一轮

## 关键技术实现

### 1. 时间同步
```csharp
void FixedUpdate()
{
    timeMs = (Time.time - startTime) * 1000;
    // 检测按键状态
    vectionResponse = Input.GetKey(KeyCode.Alpha1);
    // 执行相应的实验模式
}
```

### 2. 精确定时
```csharp
if (Mathf.Abs((timeMs - bufferDurTime) - frameNum * updateInterval * 1000) < 0.1f)
{
    // 更新摄像头位置
    // 切换到下一帧
}
```

### 3. 数据保存
- 实时CSV格式数据记录
- 自动生成带时间戳的文件名
- 保存路径：`D:/vectionProject/public/`

## 使用指南

### 1. 实验前准备
1. 设置参与者信息
2. 选择实验模式
3. 调整摄像头参数
4. 检查数据保存路径

### 2. 运行实验
1. 启动Unity场景
2. 参与者按键1报告Vection感知
3. 系统自动记录数据
4. 实验完成后自动保存

### 3. 数据获取
- 实验数据保存在指定路径
- 文件名格式：`日期_Natural_方向_条件_参与者_试验编号.csv`

## 技术特点

### 1. 实时性能
- 60fps高帧率渲染
- 毫秒级时间精度
- 即时混合算法

### 2. 可扩展性
- 模块化设计
- 参数化配置
- 易于添加新的混合算法

### 3. 数据完整性
- 同步数据记录
- 完整的实验参数记录
- 标准化数据格式

## 研究应用

这个实验环境直接支持以下研究目标：
1. **时间线性混合函数的评估**
2. **主观速度再现性的测量**
3. **改进混合函数的效果验证**
4. **多视点映像的即时混合技术开发**

通过这个系统，可以系统地测试和比较不同混合算法对主观速度再现性的影响，为遠隔操縦系统的视觉显示优化提供科学依据。